<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SHL Recommender</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Arial;margin:20px}
    input,textarea{width:100%;padding:10px;margin:8px 0}
    button{padding:8px 12px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
  </style>
</head>
<body>
  <h2>SHL Assessment Recommender</h2>
  <textarea id="query" rows="3" placeholder="Paste job description or query"></textarea>
  <div>
    <label>Top K:
      <input id="topk" type="number" value="5" min="1" max="10" style="width:80px" />
    </label>
    <button id="go">Recommend</button>
  </div>
  <div id="status" style="margin-top:8px;color:#666"></div>
  <table id="results" style="display:none">
    <thead><tr><th>Name</th><th>URL</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    const apiUrl = localStorage.getItem('API_URL') || "https://shl-assessment-3.onrender.com/recommend";
    document.getElementById('go').onclick = async () => {
      const q = document.getElementById('query').value.trim();
      const top_k = parseInt(document.getElementById('topk').value || "5", 10);
      if(!q){ alert("Enter a query"); return; }
      document.getElementById('status').textContent = "Calling API...";
      try {
        const res = await fetch(apiUrl, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({query: q, top_k: top_k})
        });
        if(!res.ok){ throw new Error("API error: " + res.status); }
        const data = await res.json();
        const list = data.recommended_assessments || data;
        const tbody = document.querySelector('#results tbody');
        tbody.innerHTML = '';
        for(const item of list){
          const tr = document.createElement('tr');
          const nameTd = document.createElement('td');
          const urlTd = document.createElement('td');
          const typeTd = document.createElement('td');
          const durTd = document.createElement('td');
          nameTd.textContent = item.name || '';
          urlTd.innerHTML = `<a href="${item.url}" target="_blank">${item.url}</a>`;
          typeTd.textContent = (item.test_type || []).join('; ');
          durTd.textContent = item.duration || '';
          tr.appendChild(nameTd); tr.appendChild(urlTd); tr.appendChild(typeTd); tr.appendChild(durTd);
          tbody.appendChild(tr);
        }
        document.getElementById('results').style.display = 'table';
        document.getElementById('status').textContent = `Returned ${list.length} results.`;
      } catch (err) {
        document.getElementById('status').textContent = 'Error: ' + err.message;
      }
    };
  </script>
</body>
</html>
